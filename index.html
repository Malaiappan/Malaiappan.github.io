<!DOCTYPE html>
  <html>
    <head>
      <link rel="manifest" href="manifest.json">
      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
      <link type="text/css" rel="stylesheet" href="css/style.css"  media="screen,projection"/>
      <link rel="stylesheet" href="css/font-awesome.min.css"  media="screen,projection"/>
      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content='width=device-width, initial-scale=1.0, user-scalable=0'/>
      <meta name="apple-mobile-web-app-title" content="KLM">
      <link rel="icon" type="image/png" href="/images/icon175x175.png" sizes="192x192">
        <link rel="icon" type="image/png" href="/images/icon175x175.png" sizes="160x160">
        <link rel="icon" type="image/png" href="/images/icon175x175.png" sizes="96x96">
        <link rel="icon" type="image/png" href="/images/icon175x175.png" sizes="16x16">
        <link rel="icon" type="image/png" href="/images/icon175x175.png" sizes="32x32">

    </head>

    <body>

      <!--Import jQuery before materialize.js-->
      <header>
       <nav>
       <div class="nav-wrapper">
       <a href="#!"  class="brand-logo center"><img src="images/logo1.png" height="50px"/></a>
       <a href="#" data-activates="slide-out" class="button-collapse"><i class="fa fa-bars fa-lg" aria-hidden="true" style="color:#00a1de; padding-left:20px;"></i></a>
      </div>
      </nav>
      </header>
	    
      <ul id="slide-out" class="side-nav">
          <li> <a class=" subheader list-group-item" href="#">Booking Menu</a> </li>
          <li><a id="newSearch" class="waves-effect list-group-item"><i class="fa fa-suitcase" aria-hidden="true"></i>Book for new travel</a></li>
          <li><a id="viewRecentSearch" class="waves-effect list-group-item"><i class="fa fa-search" aria-hidden="true"></i>My recent searches</a></li>
          <li><div class="divider"></div></li>
          <li><a class="subheader">Checkin Menu</a></li>
          <li><a id="myBookings" class="waves-effect"><i class="fa fa-bookmark" aria-hidden="true"></i>My Bookings</a></li>
          <li><a class="waves-effect"><i class="fa fa-check" aria-hidden="true"></i>Checkin for flights</a></li>
          <li><div class="divider"></div></li>
          <li><a class="subheader">Ready for travel</a></li>
          <li><a id="boardingPass" class="waves-effect"> <i class="fa fa-file" aria-hidden="true"></i>Boarding passes</a></li>
      </ul>
  
	    
      <!-- Main Container Start-->
      <main>
      <div id="preload-div">
      <div id="preloader" > 
           <div class="preloader-wrapper small active">
            <div class="spinner-layer spinner-blue-only">
              <div class="circle-clipper left">
                <div class="circle"></div>
              </div><div class="gap-patch">
                <div class="circle"></div>
              </div><div class="circle-clipper right">

                <div class="circle"></div> 
              </div>
            </div>

          </div>
         
          
        </div>
         <p id="preloader-txt" class="pre-txt"> Welcome! <br/> You are now on the beta version of KLM Airline's Progressive web app</p>

         </div>
      <div id="home" class="container1" style="display: none;">
        <h5 style="border-left:5px solid #00a1de; padding-left:5px;">Search flights</h5>
      <div class="row">
      
      <div class="row">
        <div class="input-field col s12">
          <input id="from" type="text" class="validate">
          <label for="icon_prefix">From</label>
        </div>
        <div class="input-field col s12">
          <input id="to" type="text" class="validate">
          <label for="icon_telephone">To</label>
        </div>
         <div class="input-field col s12">
          <input id="date" type="text" class="validate" value="22OCT">
          <label for="icon_telephone" class="active">Date</label>
        </div>
        <div class="input-field col s12">
          <input id="NumOfPax" type="text" class="validate">
          <label for="icon_telephone">Number of Passengers</label>
        </div>
        
        </div>
            <div style="float:right; padding-right:10px">
              <a class="waves-effect waves-light btn" id="viewoffers"> View Offers <i class="fa fa-angle-right" aria-hidden="true"></i></a>
               </div>
              </div>
        
      </div> <!-- Home End -->
      <div id="flightinfo" class="container1" style="display: none;">
	      <h5 style="border-left:5px solid #00a1de; padding-left:5px;">Available flights</h5>
       <table id="flightsTable" class="striped" >
       <!--  <thead> added for reference
          <tr>
              <th data-field="id">From</th>
              <th data-field="name">To</th>
              <th data-field="price">Date</th>
              <th data-field="price">Time</th>
              <th data-field="price">Price</th>
              <th></th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td>AMS</td>
            <td>MAD</td>
            <td>22 OCT</td>
            <td>17:25</td>
            <td>110 E</td>
            <td><a  id="btnmod" class="waves-effect waves-light btn">Book</a></td>
          </tr>
            <tr>
            <td>AMS</td>
            <td>MAD</td>
            <td>22 OCT</td>
            <td>17:25</td>
             <td>110 E</td>
            <td><a  id="btnmod" class="waves-effect waves-light btn">Book</a></td>
          </tr>
        </tbody> -->
      </table>
      </div> <!--Flight info-->
        <div id="backtosearchdiv" style="display: none;">
          <a class="waves-effect waves-light btn" id="backtosearch"><i class="fa fa-angle-left" aria-hidden="true"></i>&nbsp;Back to Search 
               
              </a>
        </div>
	      
	<div id="recentSearches" class="container1" style="display: none;">
        <h5 style="border-left:5px solid #00a1de; padding-left:5px;">Recent Search </h5>
        <table id="recentSearchesTable" class="striped" >
     <!--   <thead> added for reference
          <tr>
              <th data-field="id">From</th>
              <th data-field="name">To</th>
              <th data-field="price">Date</th>
	      <th data-field="price">Search again</th>
              <th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>AMS</td>
            <td>MAD</td>
            <td>22 OCT</td>
            <td><a  id="btnmod" class="waves-effect waves-light btn"><i class="material-icons center">replay</i></a></td>
          </tr>
            <tr>
            <td>AMS</td>
            <td>MAD</td>
            <td>22 OCT</td>
            <td><a  id="btnmod" class="waves-effect waves-light btn"><i class="material-icons center">replay</i></a></td>
          </tr>
        </tbody>-->
      </table> 
     </div><!--recent searches-->
	<div id="backtosearchdiv" style="display: none;">
          <a class="waves-effect waves-light btn" id="backtosearch"><i class="fa fa-angle-left" aria-hidden="true"></i>&nbsp;Back to Search 
                
              </a >
       
      </div> 
	      
	      <div id="passengerinfo" class="container1" style="display:none">
               <h5 style="border-left:5px solid #00a1de; padding-left:5px;">Enter your personal information</h5>
        <div class="row">
        <div class="input-field col s12">
          <input id="icon_prefix" type="text" class="validate"><label for="icon_prefix">Name</label>
        </div>
        <div class="input-field col s12">
          <input id="icon_telephone" type="text" class="validate"> <label for="icon_telephone">Last Nmae</label>
        </div>
        
        <div class="input-field col s12">
          <input id="icon_telephone" type="text" class="validate"> <label for="icon_telephone">Date of Birth</label>
        </div>
        
        <div class="input-field col s12">
          <input id="icon_telephone" type="number" class="validate"> <label for="icon_telephone">Phone Number</label>
        </div>
        <div class="input-field col s12">
          <input id="icon_telephone" type="email" class="validate"> <label for="icon_telephone">Email</label>
        </div>
        </div>
         <div style="float:right; padding-right:10px;"> <a class="waves-effect waves-light btn" href="#modal1" id="confirm">Confirm</a>
                 
         </div>
             <!-- Modal Structure -->
            <div id="modal1" class="modal bottom-sheet">
            <div class="modal-content">
            <h4>Booking Confirmed!</h4>
            <p> Ticket Reference : X098YJ <br> Umar Kathap Abdul Abbas </p>
            </div>
            <div class="modal-footer">
            <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat" id="ebp">Checkin automatically &amp; Get Boarding Pass</a>
            </div>
            </div>
        </div> <!-- End of Passgener Info -->
        
        <div id="confirmation" class="container1" style="display:none">
            
           <img class="responsive-img" src="images/Ebp.png">
            
        <div  style="padding-top:10px; border-top:1px solid #ccc; height:1px;"></div> 
          <div style="float:right; padding-right:10px; padding-top:10px;"> <a class="waves-effect waves-light btn" id="done">Done</a>
            
        </div><!-- Confimration -->
      </main>

      
      <!-- Main Container End -->
        <footer class="page-footer">
          <div class="container">
            <div class="row">
              <div class="col l6 s12">
                <h5 class="white-text">Welcome!</h5>
                <p class="grey-text text-lighten-4">You are now on the beta version of KLM Airline's Progressive web app
              </div>
           
            </div>
          </div>
          <div class="footer-copyright">
            <div class="container">
            Powered by Tata Consultancy Services
            <a class="grey-text text-lighten-4 right" href="https://www.klm.com/home/nl/nl#/tab=hpTbMyKlm">KLM.COM</a>
            </div>
          </div>
        </footer>    
	      
      <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
      <script type="text/javascript" src="js/materialize.min.js"></script>
         <script src="/static/js/app.js" async></script>
      <script type="text/javascript">
      $( document ).ready(function(){
	 $('.modal-trigger').leanModal();
        $(".button-collapse").sideNav();
	      
	 var today = new Date(); var dd = today.getDate(); var mm = today.getMonth()+1; //January is 0! 
            var yyyy = today.getFullYear(); 
            if(dd<10) {    dd='0'+dd } 
            if(mm<10) {    mm='0'+mm} 
            today = mm+'/'+dd+'/'+yyyy;
	 $("#date").val(today);     
	      
        setTimeout(function() {
         $('#preload-div').hide();
	 if (localStorage.searchedRoutes !== undefined) {
	  var searchedRoutes = JSON.parse(localStorage.searchedRoutes)
	  console.log(searchedRoutes)
	  if (searchedRoutes.length > 0) {
		  getDataFromLocalStorage();
		  $('#flightinfo').show('fadeIn');
           	 $('#backtosearchdiv').show('fadeIn');  
	  } 
	 } else {
          	 $('#home').show("fadeIn");
	  }
        
        }, 2000);

          $( "#viewoffers" ).click(function() {
            $('#home').hide("fadeOut");
            $('#flightinfo').show('fadeIn');
          });


          $( "#backtosearch" ).click(function() {
            $('#flightinfo').hide("fadeOut");
	    $('#backtosearchdiv').hide('fadeOut');  
            $('#home').show('fadeIn');
          });
	  
	    $( "#newSearch" ).click(function() {
		    $('.button-collapse').sideNav('hide');
		    $("main").find("div.container1:visible").hide();
		     $('#backtosearchdiv').hide('fadeOut');
		    $('#home').show('fadeIn');
		    
	     });  

	  $( "#viewRecentSearch" ).click(function() {
            $('#home').hide("fadeOut");
            $('#recentSearches').show('fadeIn');
          });

          $("tr").on("click", "a#bookButton_0", function() {
          	$('#flightinfo').hide("fadeOut");
          	$('#passengerinfo').show('fadeIn');
              //$('#modal1').openModal();
          });
	      
	      $("#offer").click(function() { alert("hi") });
          
           $( "#confirm" ).click(function() {
          
              $('#modal1').openModal();
          });
          
         $( "#ebp" ).click(function() {
              
         // $('#passengerinfo').hide("fadeOut");
         // $('#confirmation').show('fadeIn');
		if (fcmToken !== "") {		 
			setTimeout(function() {
				var content = {notification: {title: "KLM - Boarding Pass",body: "Boarding pass for your flight",icon: "images/logo.png",click_action: "https://malaiappan.github.io"},to:""}
				content.to = fcmToken;

				$.ajax({
				    url: 'https://fcm.googleapis.com/fcm/send',
				    type: 'POST',
					beforeSend: function(xhr){
						xhr.setRequestHeader('Authorization', 'key=AIzaSyANQgbxQIyOASMdVU24T-wthqHRiAj8lmE');
						xhr.setRequestHeader('Content-Type', 'application/json');
					},
				    data: JSON.stringify(content),
				    success: function (data) {
					console.info(data);
				    }
				});

			}, 5000);
		}
          });
	      
	 $( "#boardingPass" ).click(function() { 
           $('.button-collapse').sideNav('hide');
	   $("main").find("div.container1:visible").hide();
            $('#confirmation').show('fadeIn');
         });
          
         $( "#done" ).click(function() {
          $('#confirmation').hide("fadeOut");
          $('#home').show('fadeIn');
          $('.modal-trigger').closeModal();
        });

      });
	      

      </script>
	      
	

<script src="https://www.gstatic.com/firebasejs/3.5.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.5.0/firebase-messaging.js"></script>

<script>
	var fcmToken = "";
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBrvwd831mxb6egGjQInMwztkMtObfjjmg",
    authDomain: "pwa-test-72a20.firebaseapp.com",
    databaseURL: "https://pwa-test-72a20.firebaseio.com",
    storageBucket: "pwa-test-72a20.appspot.com",
    messagingSenderId: "1031604326543"
  };
  firebase.initializeApp(config);

// Retrieve Firebase Messaging object.
const messaging = firebase.messaging();

messaging.requestPermission()
.then(function() {
  console.log('Notification permission granted.');
  return messaging.getToken()
})
.then(function(token) {
	console.log(token);
	$(".custom__button").html(token);
	fcmToken = token;
})
.catch(function(err) {
  console.log('Unable to get permission to notify. ', err);
});
	</script>
	      
    </body>
  </html>
        
